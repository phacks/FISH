<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="fr">
<head>
<!-- Generated by javadoc (version 1.7.0_45) on Tue Dec 10 22:00:34 CET 2013 -->
<title>ClientFailureDetector</title>
<meta name="date" content="2013-12-10">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ClientFailureDetector";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ClientFailureDetector.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../logic/Client.html" title="class in logic"><span class="strong">Prev Class</span></a></li>
<li><a href="../logic/ClientHandler.html" title="class in logic"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?logic/ClientFailureDetector.html" target="_top">Frames</a></li>
<li><a href="ClientFailureDetector.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">logic</div>
<h2 title="Class ClientFailureDetector" class="title">Class ClientFailureDetector</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>logic.ClientFailureDetector</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Runnable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">ClientFailureDetector</span>
extends java.lang.Object
implements java.lang.Runnable</pre>
<div class="block">Detects and handles the clients crashes. This thread is launched by the server in its constructor.
 To detect crashes, it tries to connect to the server part of a client, and sends a "ping" message.
 If the connection failed, or the reply was something other than "pong", the client is considered crashed.
 It is then removed, along with its files, from the database.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../logic/Server.html" title="class in logic"><code>Server</code></a>, 
<a href="../logic/Client.html" title="class in logic"><code>Client</code></a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#address">address</a></strong></code>
<div class="block">The IP address of the client which is being tested</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#clientName">clientName</a></strong></code>
<div class="block">The name of the client which is being tested</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) java.sql.Connection</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#connection">connection</a></strong></code>
<div class="block">The connection to the datasource</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.sql.PreparedStatement</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#deleteFilesStatement">deleteFilesStatement</a></strong></code>
<div class="block">A SQL statement aiming at deleting a client's files in the database</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) int</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#downloadPort">downloadPort</a></strong></code>
<div class="block">The download port of the client which is being tested</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.sql.PreparedStatement</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#findClientsStatement">findClientsStatement</a></strong></code>
<div class="block">A SQL statement aiming at finding all the clients in the database</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) java.io.BufferedReader</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#rd">rd</a></strong></code>
<div class="block">The BufferedReader used to read incoming messages from the client</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) java.net.Socket</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#socket">socket</a></strong></code>
<div class="block">The socket used to communicate with the server side of the client</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) java.sql.PreparedStatement</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#unregisterClientStatement">unregisterClientStatement</a></strong></code>
<div class="block">A SQL statement aiming at deleting a client in the database</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#UPDATE_TIME">UPDATE_TIME</a></strong></code>
<div class="block">The time after which all clients are pinged again</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) java.io.PrintWriter</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#wr">wr</a></strong></code>
<div class="block">The BufferedReader used to send messages to the client</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../logic/ClientFailureDetector.html#ClientFailureDetector(java.sql.Connection)">ClientFailureDetector</a></strong>(java.sql.Connection&nbsp;connection)</code>
<div class="block">Prepares the SQL statements</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#pingClient(java.lang.String, int)">pingClient</a></strong>(java.lang.String&nbsp;address,
          int&nbsp;downloadPort)</code>
<div class="block">Pings a particular client by trying to connect to its server-side port, and sending 
 a "ping" message.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../logic/ClientFailureDetector.html#run()">run</a></strong>()</code>
<div class="block">All the clients in the databased are pinged.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="connection">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>connection</h4>
<pre>java.sql.Connection connection</pre>
<div class="block">The connection to the datasource</div>
</li>
</ul>
<a name="findClientsStatement">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>findClientsStatement</h4>
<pre>private&nbsp;java.sql.PreparedStatement findClientsStatement</pre>
<div class="block">A SQL statement aiming at finding all the clients in the database</div>
</li>
</ul>
<a name="socket">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>socket</h4>
<pre>java.net.Socket socket</pre>
<div class="block">The socket used to communicate with the server side of the client</div>
</li>
</ul>
<a name="wr">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>wr</h4>
<pre>java.io.PrintWriter wr</pre>
<div class="block">The BufferedReader used to send messages to the client</div>
</li>
</ul>
<a name="rd">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>rd</h4>
<pre>java.io.BufferedReader rd</pre>
<div class="block">The BufferedReader used to read incoming messages from the client</div>
</li>
</ul>
<a name="unregisterClientStatement">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>unregisterClientStatement</h4>
<pre>java.sql.PreparedStatement unregisterClientStatement</pre>
<div class="block">A SQL statement aiming at deleting a client in the database</div>
</li>
</ul>
<a name="clientName">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>clientName</h4>
<pre>java.lang.String clientName</pre>
<div class="block">The name of the client which is being tested</div>
</li>
</ul>
<a name="address">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>address</h4>
<pre>java.lang.String address</pre>
<div class="block">The IP address of the client which is being tested</div>
</li>
</ul>
<a name="downloadPort">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>downloadPort</h4>
<pre>int downloadPort</pre>
<div class="block">The download port of the client which is being tested</div>
</li>
</ul>
<a name="deleteFilesStatement">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deleteFilesStatement</h4>
<pre>private&nbsp;java.sql.PreparedStatement deleteFilesStatement</pre>
<div class="block">A SQL statement aiming at deleting a client's files in the database</div>
</li>
</ul>
<a name="UPDATE_TIME">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>UPDATE_TIME</h4>
<pre>private final&nbsp;int UPDATE_TIME</pre>
<div class="block">The time after which all clients are pinged again</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../constant-values.html#logic.ClientFailureDetector.UPDATE_TIME">Constant Field Values</a></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ClientFailureDetector(java.sql.Connection)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ClientFailureDetector</h4>
<pre>public&nbsp;ClientFailureDetector(java.sql.Connection&nbsp;connection)
                      throws java.sql.SQLException</pre>
<div class="block">Prepares the SQL statements</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>connection</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.sql.SQLException</code></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="run()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>run</h4>
<pre>public&nbsp;void&nbsp;run()</pre>
<div class="block">All the clients in the databased are pinged. If the client is detected as crashed, 
 he and his files are removed from the database. This operation is repeated constantly, 
 and sleeps for a given mount of time defined by the UPDATE_TIME constant</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code>run</code>&nbsp;in interface&nbsp;<code>java.lang.Runnable</code></dd>
<dt><span class="strong">See Also:</span></dt><dd><code>Runnable.run()</code></dd></dl>
</li>
</ul>
<a name="pingClient(java.lang.String, int)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>pingClient</h4>
<pre>private&nbsp;void&nbsp;pingClient(java.lang.String&nbsp;address,
              int&nbsp;downloadPort)
                 throws java.io.IOException</pre>
<div class="block">Pings a particular client by trying to connect to its server-side port, and sending 
 a "ping" message. If the connexion fails or the reply is not "pong", the client is considered as crashed 
 and handled in an IO Exception.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>address</code> - The IP address of the client</dd><dd><code>downloadPort</code> - The server-side port of the client</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code> - The exception will trigger the unregistration process</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ClientFailureDetector.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../logic/Client.html" title="class in logic"><span class="strong">Prev Class</span></a></li>
<li><a href="../logic/ClientHandler.html" title="class in logic"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?logic/ClientFailureDetector.html" target="_top">Frames</a></li>
<li><a href="ClientFailureDetector.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
